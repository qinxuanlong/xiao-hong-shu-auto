"""
将书单数据补充到 topics.csv
"""
import pandas as pd
from pathlib import Path
import random
import sys
import io

# 设置控制台编码为 UTF-8
if sys.platform == "win32":
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding="utf-8")

# 项目根目录
project_root = Path(__file__).parent.parent
topics_csv_path = project_root / "data" / "topics.csv"

# 读取现有数据
if topics_csv_path.exists():
    existing_df = pd.read_csv(topics_csv_path, encoding="utf-8")
    # 获取已存在的书名（避免重复）
    existing_books = set(existing_df["书籍"].dropna().tolist())
else:
    existing_df = pd.DataFrame(columns=["痛点", "人群", "书籍", "金句", "status"])
    existing_books = set()

# 书单数据
book_list_data = {
    "个人成长": [
        "别让微压力消耗你", "聪明人的个人成长", "5分钟高效休息法", "高效放松", "惯性带你飞",
        "时间盒", "早上还什么都不想干，晚上就都做完了", "这就是心理学", "心理学与生活",
        "别相信直觉", "怎样决定大事", "人生十年，不可辜负的20岁到30岁", "中年之路",
        "我们为什么而活", "不被定义的年龄", "我从何来", "自驱型成长", "深度看见：艾瑞克森催眠法",
        "恐惧给你的礼物", "不配得感", "男性困境", "撑起TA的晴天", "爱的艺术", "非暴力沟通",
        "关键对话", "如何让你爱的人爱上你", "原则", "思考，快与慢", "终身成长", "刻意练习",
        "异类", "掌控习惯", "原子习惯", "高效能人士的七个习惯", "精要主义", "断舍离",
        "微习惯", "清单革命", "自控力", "意志力", "心智力", "认知觉醒", "打开心智",
        "大脑整理术", "思考的技术", "学会提问", "批判性思维工具", "逻辑思维简易入门",
        "金字塔原理", "系统思考", "第五项修炼", "跃迁", "知识大迁移", "好奇心",
        "如何阅读一本书", "深阅读", "快速阅读术", "过目不忘的读书法", "写作这门手艺",
        "故事课", "文案训练手册", "影响力", "说服", "先发影响力", "优势谈判", "博弈论",
        "驱动力", "内在动机", "为自己活一次", "被忽视的孩子", "为何家会伤人", "这不是你的错",
        "身体知道答案", "感谢自己的不完美", "抱住棒棒的自己", "你今天真好看", "一见你就好心情",
        "我可以咬一口吗", "我是你的小狗", "阿狸的下一站", "我的世界很小，但刚刚好",
        "我离开之后", "男孩、鼹鼠、狐狸和马", "你想活出怎样的人生", "永恒的终结", "海边小屋",
        "山之四季", "明天也是小春日和", "此刻的温柔", "人间值得", "世间一切烦恼，都是自找的"
    ],
    "理财投资": [
        "富爸爸，穷爸爸", "有钱人和你想的不一样", "拿铁因子", "小狗钱钱", "投资最重要的事",
        "穷查理宝典", "致富心态", "慢慢变富", "周期", "掌握市场周期", "预测：经济、周期与市场泡沫",
        "指数基金投资指南", "我毕业五年，用ETF赚到400万", "无脑理财术，小资大翻身！", "常识的力量",
        "不当决策", "灰阶思考", "理性的非理性", "简单致富", "无限投资", "A大的理财金律",
        "叫卖竹竿的小贩为什么不会倒？", "聪明的投资者", "证券分析", "巴菲特致股东的信",
        "怎样选择成长股", "彼得·林奇的成功投资", "战胜华尔街", "投资中最简单的事",
        "投资中不简单的事", "钱：7步创造终身收入", "财务自由之路", "邻家的百万富翁", "思考致富",
        "百万富翁快车道", "稳健投资", "定投十年财务自由", "手把手教你读财报", "财报就像一本故事书",
        "薛兆丰经济学讲义", "经济学的思维方式", "小岛经济学", "货币战争", "逃不开的经济周期",
        "债务危机", "非理性繁荣", "黑天鹅", "反脆弱", "随机漫步的傻瓜", "成功与运气",
        "牛奶可乐经济学", "贫穷的本质", "稀缺：我们是如何陷入贫穷与忙碌", "错误的行为",
        "助推", "赢家的诅咒", "怪诞行为学", "巴比伦最富有的人", "管道的故事", "选择做富人",
        "有钱人是这样赚钱的", "炒股的智慧", "日本蜡烛图技术", "股票大作手回忆录", "金融炼金术",
        "涛动周期论", "穿越迷雾", "价值", "投资至简", "一个投资家的20年", "您厉害，您赚得多",
        "投资要义", "逆向投资", "戴维斯王朝", "机构投资的创新之路", "共同基金常识", "漫步华尔街",
        "有效资产管理", "资产配置的艺术", "债券投资策略", "对冲基金奇才", "华尔街之狼",
        "大空头", "说谎者的扑克牌", "门口的野蛮人", "伟大的博弈", "中国式价值投资",
        "投资中国", "十年一梦", "私募的进化", "更富有、更睿智、更快乐", "像巴菲特一样交易",
        "查理·芒格的原则", "巴菲特之道", "巴菲特的投资组合", "巴菲特传", "滚雪球",
        "段永平投资问答录", "李录：文明、现代化、价值投资与中国"
    ]
}

# 痛点模板
growth_pain_points = [
    "总觉得生活没有方向", "不知道如何提升自己", "容易焦虑迷茫",
    "想要改变却无从下手", "想要养成好习惯", "想要提升思维能力",
    "想要学会高效阅读", "想要改善人际关系", "想要摆脱负面情绪",
    "想要找到人生意义", "想要突破自我限制", "想要更好的沟通技巧"
]

finance_pain_points = [
    "存不下钱", "想要实现财务自由", "不懂投资理财",
    "不知道怎么让钱生钱", "想要摆脱月光族", "想要学会价值投资",
    "想要理解经济周期", "想要建立理财思维", "想要避免理财陷阱",
    "想要了解巴菲特的投资智慧", "想要学习投资策略", "想要稳健增值"
]

# 人群模板
target_audiences = [
    "职场新人", "学生党", "宝妈", "职场人", "想要自我提升的人",
    "有储蓄需求的人", "投资者", "终身学习者", "有困惑的年轻人", "追求成长的人"
]

# 金句模板
growth_quotes = [
    "成长是一场与自己的对话",
    "认知决定了你的上限",
    "行动是治愈焦虑的良药",
    "习惯决定命运",
    "思考力是核心竞争力",
    "阅读是门槛最低的高贵",
    "改变从当下开始"
]

finance_quotes = [
    "复利是世界第八大奇迹",
    "投资是认知的变现",
    "时间是投资者的朋友",
    "慢慢变富才是真正的富有",
    "理财不只是钱的事，更是心的事",
    "价值投资是长期主义的胜利",
    "分散投资是唯一的免费午餐"
]

# 生成新数据
new_rows = []
added_count = 0
skipped_count = 0

for category, books in book_list_data.items():
    for book in books:
        # 跳过已存在的书
        if book in existing_books:
            skipped_count += 1
            continue

        if category == "个人成长":
            pain_point = random.choice(growth_pain_points)
            quote = random.choice(growth_quotes)
        else:  # 理财投资
            pain_point = random.choice(finance_pain_points)
            quote = random.choice(finance_quotes)

        audience = random.choice(target_audiences)

        new_rows.append({
            "痛点": pain_point,
            "人群": audience,
            "书籍": book,
            "金句": quote,
            "status": "unpublished"
        })
        added_count += 1

# 合并数据
if new_rows:
    new_df = pd.DataFrame(new_rows)
    combined_df = pd.concat([existing_df, new_df], ignore_index=True)
else:
    combined_df = existing_df

# 保存
combined_df.to_csv(topics_csv_path, index=False, encoding="utf-8-sig")

print(f"✅ 完成！")
print(f"   新增书籍: {added_count} 本")
print(f"   跳过重复: {skipped_count} 本")
print(f"   总计: {len(combined_df)} 条记录")
